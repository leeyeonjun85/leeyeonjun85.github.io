---
title: "CV - í•©ì„±ê³± ì‹ ê²½ë§(CNN)"
excerpt: "ì»´í“¨í„° ë¹„ì „ : í•©ì„±ê³± ì‹ ê²½ë§(Convolutional Neural Network)"

categories:
  - Dev Log

tags:
  - ê°œë°œì¼ì§€
  - ì½”ë”©
  - Python
  - CV
  - ì»´í“¨í„°ë¹„ì „
  - í•©ì„±ê³±ì‹ ê²½ë§

use_math: true

header:
  teaser: /assets/images/etc/square-2724387_1920.jpg

last_modified_at: 2023-05-12
---




<br><br><br><br>

![image](https://leeyeonjun85.github.io/assets/images/post/cv_1/220px-Conv_layers.png){: .align-center width="50%"}  

<br><br><br><br>




# CV - í•©ì„±ê³± ì‹ ê²½ë§(CNN)  
> ì»´í“¨í„° ë¹„ì „ : í•©ì„±ê³± ì‹ ê²½ë§(Convolutional Neural Network, CNN)  

- AIë¥¼ ê³µë¶€í•˜ë©´ì„œ ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” NLPìª½ë§Œ ê³µë¶€í•˜ë‹¤ë³´ë‹ˆ CVë¶„ì•¼ì˜ í•™ìŠµì´ ë¶€ì¡±í•œê²ƒ ê°™ìŒ  
- ì»´í“¨í„° ë¹„ì „ ë¶„ì•¼ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•´ ë³´ì  
{: .notice--success}




<br><br><br><br>




## í•©ì„±ê³± ì‹ ê²½ë§(Convolutional Neural Network, CNN)ì˜ êµ¬ì¡°
- í•©ì„±ê³± ì‹ ê²½ë§ì€ `íŠ¹ì§• ì¶”ì¶œ ë¶€ë¶„`, `ë¶„ë¥˜ë¥¼ ìœ„í•œ ì‹ ê²½ë§` ë‘ ê°€ì§€ êµ¬ì¡°ë¡œ êµ¬ì„±  
  ![image](../../assets/images/post/cv_1/yVw7una.png){: .align-center width="80%"}  

- íŠ¹ì§• ì¶”ì¶œ ë¶€ë¶„
  - `í•©ì„±ê³±` ì¸µ(Convolution Layer)ê³¼ `í’€ë§` ì¸µ(Pooling Layer)ìœ¼ë¡œ êµ¬ì„±
  - í•©ì„±ê³± ì‹ ê²½ë§ì€ í•©ì„±ê³± ì¸µì˜ `Filterì˜ ê°€ì¤‘ì¹˜`ë¥¼ í•™ìŠµ
- ë¶„ë¥˜ë¥¼ ìœ„í•œ ì‹ ê²½ë§
  - ì¼ë°˜ì  ì¸ê³µì‹ ê²½ë§ì˜ `ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡ ` ì‹ ê²½ë§ìœ¼ë¡œ êµ¬ì„±í•˜ë©´ ë¨
  - `ì™„ì „ ì—°ê²° ì‹ ê²½ë§`(Fully Connected Layer)ì´ë¼ê³  ë¶ˆë¦¼


<br><br>


### íŠ¹ì§• ì¶”ì¶œ ë¶€ë¶„
#### í•©ì„±ê³±(Convolution Layer)
- í•©ì„±ê³± ì¸µì—ì„œëŠ” `í•©ì„±ê³± í•„í„°`(Convolution Filter)ê°€ ìŠ¬ë¼ì´ë”©(Sliding)í•˜ë©° ì´ë¯¸ì§€ ë¶€ë¶„ë¶€ë¶„ì˜ `íŠ¹ì§•ì„ ì¶”ì¶œ`  
  ![image](../../assets/images/post/cv_1/conv_ex1-1.png){: .align-center width="70%"} 

<br>

#### íŒ¨ë”©(Padding)
- ì—°ì‚°ë˜ì–´ ë‚˜ì˜¤ëŠ” Output, ì¦‰ Feature map ì˜ í¬ê¸°ë¥¼ ì¡°ì ˆí•˜ê³  ì‹¤ì œ ì´ë¯¸ì§€ ê°’ì„ ì¶©ë¶„íˆ í™œìš©í•˜ê¸° ìœ„í•´, ì´ë¯¸ì§€ ì™¸ë¶€ë¥¼ íŠ¹ì •í•œ ê°’ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ëŠ” ë°©ë²•
- ì£¼ë¡œ '0'ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ì£¼ëŠ” ì œë¡œíŒ¨ë”©(Zero-Padding)ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©ë¨  
  ![image](../../assets/images/post/cv_1/GRDbmHF.gif){: .align-center width="70%"} 

<br>

#### ìŠ¤íŠ¸ë¼ì´ë“œ(Stride)
- ìŠ¬ë¼ì´ë”©(Sliding)ì‹œì— ëª‡ ì¹¸ ì”© ê±´ë„ˆë›¸ì§€ ê²°ì •
  - í•„í„°ê°€ í•œ ì¹¸ì”© ìŠ¬ë¼ì´ë”©í•˜ë ¤ë©´ `Stride=1` ë¡œ ì„¤ì •
  - ë‘ ì¹¸ì”© ìŠ¬ë¼ì´ë”©í•˜ë ¤ë©´ `Stride=2` ë¡œ ì„¤ì •

- í•„í„° í¬ê¸°(Filter size), íŒ¨ë”©(Padding), ìŠ¤íŠ¸ë¼ì´ë“œ(Stride)ì— ë”°ë¥¸ Feature map í¬ê¸° ë³€í™”  
  <center style="font-size:1.5em;">  
  $N_{\text{out}} = \bigg[\frac{N_{\text{in}} + 2p - k}{s}\bigg] + 1$
  </center>  
  - $N_{\text{in}}$ : ì…ë ¥ë˜ëŠ” ì´ë¯¸ì§€ì˜ í¬ê¸°(=í”¼ì²˜ ìˆ˜) <br/>
  - $N_{\text{out}}$ : ì¶œë ¥ë˜ëŠ” ì´ë¯¸ì§€ì˜ í¬ê¸°(=í”¼ì²˜ ìˆ˜) <br/>
  - $k$ : í•©ì„±ê³±ì— ì‚¬ìš©ë˜ëŠ” ì»¤ë„(=í•„í„°)ì˜ í¬ê¸° <br/>
  - $p$ : í•©ì„±ê³±ì— ì ìš©í•œ íŒ¨ë”© ê°’ <br/>
  - $s$ : í•©ì„±ê³±ì— ì ìš©í•œ ìŠ¤íŠ¸ë¼ì´ë“œ ê°’

<br>

#### í’€ë§(Pooling)
- í’€ë§(Pooling) : ê°€ë¡œ, ì„¸ë¡œ í¬ê¸°ë¥¼ ì¤„ì´ê³ , ì¼ì • ê³µê°„ì„ ëŒ€í‘œí•˜ëŠ” íŠ¹ì§•ì„ ì¶”ì¶œ
- ìµœëŒ€ í’€ë§(Max pooling)
  - ì •í•´ì§„ ë²”ìœ„ ë‚´ì—ì„œ ê°€ì¥ í° ê°’ì„ êº¼ë‚´ì˜¤ëŠ” ë°©ì‹
- í‰ê·  í’€ë§(Average pooling)
  - ì •í•´ì§„ ë²”ìœ„ ë‚´ì— ìˆëŠ” ëª¨ë“  ìš”ì†Œì˜ í‰ê· ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹


<br><br>


### ë¶„ë¥˜ë¥¼ ìœ„í•œ ì‹ ê²½ë§
- ë¶„ë¥˜ë¥¼ ìœ„í•œ ì‹ ê²½ë§ì€ ì¼ë°˜ì ì¸ ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡  ì‹ ê²½ë§ìœ¼ë¡œ êµ¬ì„±
- ë¶„ë¥˜ë¥¼ ìœ„í•œ ì™„ì „ ì—°ê²° ì‹ ê²½ë§(Fully Connected Layer)ì€ í’€ì–´ì•¼ í•˜ëŠ” ë¬¸ì œì— ë”°ë¼ì„œ, ê³§ Classì˜ ê°œìˆ˜ì— ë”°ë¼ì„œ(2ê°œ, 10ê°œ ë¶„ë¥˜ ë“±) ì¶œë ¥ì¸µì„ ì„¤ê³„í•´ì•¼ í•¨




<br><br><br><br>




## í•©ì„±ê³± ì‹ ê²½ë§ ì˜ˆì œ : Cifar10
- ì˜ˆì œ í™˜ê²½
  ```python
  Python     : 3.10.11
  Tensorflow : 2.10.1
  TF GPU     : True
  ```

- í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
  ```python
  # Library Import
  import tensorflow as tf
  from tensorflow import keras
  from keras.models import Model, Sequential
  from keras.layers import Dense, Conv2D, MaxPooling2D, Flatten
  from keras.applications.vgg16 import VGG16
  from keras.applications.mobilenet_v2 import MobileNetV2
  from keras.applications.resnet_v2 import ResNet50V2

  from sklearn.model_selection import train_test_split
  import numpy as np
  import matplotlib.pyplot as plt
  ```

- ê°ì¢… íŒŒë¼ë¯¸í„° ì„¤ì •
  ```python
  CONFIG = dict(
      # Dataset
      test_size = .2,
      idx = 200,
      label_names = ['Airplane', 'Automobile', 'Bird', 'Cat', 'Deer', 'Dog', 'Frog', 'Horse', 'Ship', 'Truck'],
      
      # Model
      model = None,
      history = None,
      optimizer = 'adam',
      loss = 'sparse_categorical_crossentropy',
      metrics = ['accuracy'],
      batch_size = 128,
      epochs = 20,
      input_shape = (32, 32, 3),
      shape = (None, 32, 32, 3),
      
      # Misc
      seed = 83,
      save_img = 'D:/ì´ë¯¸ì§€ ì €ì¥ ê²½ë¡œ',
      )

  np.random.seed(CONFIG['seed'])
  tf.random.set_seed(CONFIG['seed'])
  ```


<br><br>


### ë°ì´í„° ì „ì²˜ë¦¬
- [CIFAR-10 dataset](https://www.cs.toronto.edu/~kriz/cifar.html)
  - 10ê°œì˜ í´ë˜ìŠ¤
    - airplane, automobile, bird, cat, deer, dog, frog, horse, ship, truck
    - í´ë˜ìŠ¤ë‹¹ ì•½ 6,000ê°œ ì´ë¯¸ì§€
  - 32x32 ì‚¬ì´ì¦ˆ, ì»¬ëŸ¬ ì´ë¯¸ì§€
  - 60,000ê°œ
    - í›ˆë ¨ìš© 50,000ê°œ
    - í‰ê°€ìš© 10,000ê°œ

- ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  ```python
  (X_train, y_train), (X_test, y_test) = keras.datasets.cifar10.load_data()
  # Normalization
  X_train = X_train.astype('float32') / 255.
  X_test = X_test.astype('float32') / 255.
  # Validation Data Split
  X_train, X_val, y_train, y_val = train_test_split(X_train, y_train, test_size=CONFIG['test_size'], random_state=CONFIG['seed'])
  ```

- ì¼ë¶€ ì´ë¯¸ì§€ í™•ì¸
  ```python
  fig, ax = plt.subplots(figsize=(10,10))

  for i, val in enumerate(range(CONFIG['idx']-10,CONFIG['idx']+10)):
      plt.subplot(5,5,i+1)
      plt.xticks([])
      plt.yticks([])
      plt.grid(False)
      plt.imshow(X_train[val])
      plt.xlabel(CONFIG['label_names'][y_train[val][0]])
  plt.show()

  fig.savefig(CONFIG['save_img']+'cifar_10_images.png', dpi=60, bbox_inches='tight')
  ```

  ![image](../../assets/images/post/cv_1/cifar_10_images.png){: .align-center width="50%"} 




<br><br>


### Sequential, Functional API, Sub Classing ë¹„êµ
- ê¸°ë³¸ì ì¸ í•©ì„±ê³± ì‹ ê²½ë§ ëª¨ë¸ì„ Sequential, Functional API, Sub Classing ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ ë¹„êµí•´ë³´ì

```cmd
ğŸ©º ì˜ì‚¬ì½”ë“œ ğŸ’‰
- ì¸í’‹ = shape(32, 32, 3) ì´ë¯¸ì§€
  - shape : ê°€ë¡œ, ì„¸ë¡œ, RGB
- í•©ì„±ê³± : Conv2D(í•„í„°=32, í•„í„°ì‚¬ì´ì¦ˆ=(3,3), íŒ¨ë”©=ì¼ì •í•˜ê²Œ, í™œì„±í•¨ìˆ˜=ë ë£¨)
- í’€ë§ : MaxPooling(í’€ë§ì‚¬ì´ì¦ˆ=(2,2))
- í•©ì„±ê³± : Conv2D(í•„í„°=64, í•„í„°ì‚¬ì´ì¦ˆ=(3,3), íŒ¨ë”©=ì¼ì •í•˜ê²Œ, í™œì„±í•¨ìˆ˜=ë ë£¨)
- í’€ë§ : MaxPooling(í’€ë§ì‚¬ì´ì¦ˆ=(2,2))
- í•©ì„±ê³± : Conv2D(í•„í„°=64, í•„í„°ì‚¬ì´ì¦ˆ=(3,3), íŒ¨ë”©=ì¼ì •í•˜ê²Œ, í™œì„±í•¨ìˆ˜=ë ë£¨)
- shape(32, 32, 3) 3ì°¨ì›ì„ 1ì°¨ì›ìœ¼ë¡œ flatten
- ë‹¤ì¸µì‹ ê²½ë§ : Dense(ë…¸ë“œ=128, í™œì„±í•¨ìˆ˜=ë ë£¨)
- ì¶œë ¥ : Dense(ì¶œë ¥=10, í™œì„±í•¨ìˆ˜=ì†Œí”„íŠ¸ë§¥ìŠ¤)
```

<br>

#### Sequential ë°©ì‹ì˜ í•©ì„±ê³± ì‹ ê²½ë§
```python
def get_cnn_seq(input_shape, classes):
    model = Sequential(name='Sequential_Model')
    model.add(Conv2D(32, (3, 3)
                    , padding='same'
                    , input_shape=input_shape
                    , activation='relu'))
    model.add(MaxPooling2D(2, 2))
    model.add(Conv2D(64, (3, 3)
                    , padding='same'
                    , activation='relu'))
    model.add(MaxPooling2D(2, 2))
    model.add(Conv2D(64, (3, 3)
                    , padding='same'
                    , activation='relu'))
    model.add(Flatten())
    model.add(Dense(128, activation='relu'))
    model.add(Dense(classes, activation='softmax'))
    return model

CONFIG['model'] = get_cnn_seq(CONFIG['input_shape'], len(CONFIG['label_names']))
print(CONFIG['model'].summary())
```

```cmd
Model: "Sequential_Model"
_________________________________________________________________
Layer (type)                Output Shape              Param #   
=================================================================
conv2d (Conv2D)             (None, 32, 32, 32)        896       
                                                                
max_pooling2d (MaxPooling2D  (None, 16, 16, 32)       0         
)                                                               
                                                                
conv2d_1 (Conv2D)           (None, 16, 16, 64)        18496     
                                                                
max_pooling2d_1 (MaxPooling  (None, 8, 8, 64)         0         
2D)                                                             
                                                                
conv2d_2 (Conv2D)           (None, 8, 8, 64)          36928     
                                                                
flatten (Flatten)           (None, 4096)              0         
                                                                
dense (Dense)               (None, 128)               524416    
                                                                
dense_1 (Dense)             (None, 10)                1290      
                                                                
=================================================================
Total params: 582,026
Trainable params: 582,026
Non-trainable params: 0
_________________________________________________________________
None
```

![image](../../assets/images/post/cv_1/model_cnn.png){: .align-center width="50%"} 

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 1.5397 - accuracy: 0.7020
```

![image](../../assets/images/post/cv_1/history_cnn_seq.png){: .align-center width="80%"} 

<br>

#### Functional API ë°©ì‹ì˜ í•©ì„±ê³± ì‹ ê²½ë§
```python
def get_cnn_fnc(shape, classes):
	inputs  = keras.Input(shape=shape)
	x       = Conv2D(32, (3,3), padding='same', activation='relu')(inputs)
	x       = MaxPooling2D(2,2)(x)
	x       = Conv2D(64, (3,3), padding='same', activation='relu')(x)
	x       = MaxPooling2D(2,2)(x)
	x       = Conv2D(64, (3,3), padding='same', activation='relu')(x)
	x       = Flatten()(x)
	x       = Dense(128, activation='relu')(x)
	outputs = Dense(classes, activation='softmax')(x)
	model   = keras.Model(inputs, outputs, name='Functional_Model')
	return model

CONFIG['model'] = get_cnn_fnc(CONFIG['input_shape'], len(CONFIG['label_names']))
print(CONFIG['model'].summary())
```

```cmd
Model: "Functional_Model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_1 (InputLayer)        [(None, 32, 32, 3)]       0         
                                                                 
 conv2d_3 (Conv2D)           (None, 32, 32, 32)        896       
                                                                 
 max_pooling2d_2 (MaxPooling  (None, 16, 16, 32)       0         
 2D)                                                             
                                                                 
 conv2d_4 (Conv2D)           (None, 16, 16, 64)        18496     
                                                                 
 max_pooling2d_3 (MaxPooling  (None, 8, 8, 64)         0         
 2D)                                                             
                                                                 
 conv2d_5 (Conv2D)           (None, 8, 8, 64)          36928     
                                                                 
 flatten_1 (Flatten)         (None, 4096)              0         
                                                                 
 dense_2 (Dense)             (None, 128)               524416    
                                                                 
 dense_3 (Dense)             (None, 10)                1290      
                                                                 
=================================================================
Total params: 582,026
Trainable params: 582,026
Non-trainable params: 0
_________________________________________________________________
```

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 1.7000 - accuracy: 0.7008
```

![image](../../assets/images/post/cv_1/history_cnn_fnc.png){: .align-center width="80%"} 

<br>

#### Sub Classing ë°©ì‹ì˜ í•©ì„±ê³± ì‹ ê²½ë§
```python
class GetCnnCLS(Model):
    def __init__(self, classes):
        super(GetCnnCLS, self).__init__(name='Sub_Classing_Model')
        self.conv1 = Conv2D(32, (3,3), padding='same', activation='relu')
        self.pool1 = MaxPooling2D(2,2)
        self.conv2 = Conv2D(64, (3,3), padding='same', activation='relu')
        self.pool2 = MaxPooling2D(2,2)
        self.conv3 = Conv2D(64, (3,3), padding='same', activation='relu')
        self.flat = Flatten()
        self.dense1 = Dense(128, activation='relu')
        self.dense2 = Dense(classes, activation='softmax')

    def call(self, inputs):
        x = self.conv1(inputs)
        x = self.pool1(x)
        x = self.conv2(x)
        x = self.pool2(x)
        x = self.conv3(x)
        x = self.flat(x)
        x = self.dense1(x)
        outputs = self.dense2(x)
        return outputs

CONFIG['model'] = GetCnnCLS(len(CONFIG['label_names']))
CONFIG['model'].build(CONFIG['shape'])
print(CONFIG['model'].summary())
```

```cmd
Model: "Sub_Classing_Model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 conv2d_6 (Conv2D)           multiple                  896       
                                                                 
 max_pooling2d_4 (MaxPooling  multiple                 0         
 2D)                                                             
                                                                 
 conv2d_7 (Conv2D)           multiple                  18496     
                                                                 
 max_pooling2d_5 (MaxPooling  multiple                 0         
 2D)                                                             
                                                                 
 conv2d_8 (Conv2D)           multiple                  36928     
                                                                 
 flatten_2 (Flatten)         multiple                  0         
                                                                 
 dense_4 (Dense)             multiple                  524416    
                                                                 
 dense_5 (Dense)             multiple                  1290      
                                                                 
=================================================================
Total params: 582,026
Trainable params: 582,026
Non-trainable params: 0
_________________________________________________________________
```

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 1.6596 - accuracy: 0.7104
```

![image](../../assets/images/post/cv_1/history_cnn_cls.png){: .align-center width="80%"} 

<br>

#### ë¹„êµ ê²°ê³¼
- ëª¨ë¸ êµ¬ì„±ë°©ë²•ë§Œ ë°”ë€ ê²ƒì´ê¸° ë•Œë¬¸ì— evaluateê²°ê³¼ì™€ í•™ìŠµê³¡ì„ ì´ 3ê°€ì§€ ëª¨ë‘ ë¹„ìŠ·í•˜ê²Œ ë‚˜íƒ€ë‚¨
  - Pytorchì™€ì˜ ì—°ê³„, ë³µì¡í•œ ëª¨ë¸ êµ¬ì„±ì„ ìœ„í•˜ì—¬ Sub Classing ë°©ì‹ì— ìµìˆ™í•´ì§€ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒ ê°™ìŒ
- ê°„ë‹¨í•œ í•©ì„±ê³± ì‹ ê²½ë§ì€ ë‹¤ì¸µí¼ì…‰íŠ¸ë¡ ê³¼ ì„±ëŠ¥ìƒ ì°¨ì´ê°€ ì—†ì–´ ë³´ì„


<br><br>


### ì „ì´í•™ìŠµ (Transfer Learning)
- ì „ì´í•™ìŠµ(Transfer Learning)ì´ë€ ê¸°ì¡´ì— ì‚¬ì „í•™ìŠµëœ(pre trained) ëª¨ë¸ì„ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” í•™ìŠµ ë°ì´í„°ë¥¼ ìµœì†Œí•™ìŠµì‹œì¼œ(Fine-tuning) ì´ìš©í•˜ëŠ” ë°©ë²•
- ëŒ€í‘œì ì¸ ì „ì´í•™ìŠµ ëª¨ë¸ì¸ [VGG16](https://www.tensorflow.org/api_docs/python/tf/keras/applications/vgg16/VGG16), [MobileNetV2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/mobilenet_v2/MobileNetV2), [ResNet50V2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/resnet_v2/ResNet50V2)ì„ ë¹„êµí•´ ë³´ì

<br>

#### [ì „ì´í•™ìŠµ : VGG16](https://www.tensorflow.org/api_docs/python/tf/keras/applications/vgg16/VGG16)
```python
class VGG16_model(Model):
    def __init__(self, classes):
        super(VGG16_model, self).__init__(name='VGG_Model')
        self.vgg = VGG16(weights='imagenet', include_top=False)
        for layer in self.vgg.layers:
            layer.trainable = False
        self.flat = Flatten()
        self.dense1 = Dense(128, activation='relu')
        self.dense2 = Dense(64, activation='relu')
        self.dense3 = Dense(classes, activation='softmax')

    def call(self, inputs):
        x = self.vgg(inputs)
        x = self.flat(x)
        x = self.dense1(x)
        x = self.dense2(x)
        outputs = self.dense3(x)
        return outputs

CONFIG['model'] = VGG16_model(len(CONFIG['label_names']))
CONFIG['model'].build(CONFIG['shape'])
print(CONFIG['model'].summary())
```

```cmd
Model: "VGG_Model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 vgg16 (Functional)          (None, None, None, 512)   14714688  
                                                                 
 flatten_6 (Flatten)         multiple                  0         
                                                                 
 dense_12 (Dense)            multiple                  65664     
                                                                 
 dense_13 (Dense)            multiple                  8256      
                                                                 
 dense_14 (Dense)            multiple                  650       
                                                                 
=================================================================
Total params: 14,789,258
Trainable params: 74,570
Non-trainable params: 14,714,688
_________________________________________________________________
```

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 1.1999 - accuracy: 0.6037
```

![image](../../assets/images/post/cv_1/history_vgg.png){: .align-center width="80%"}

<br>

#### [ì „ì´í•™ìŠµ : MobileNetV2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/mobilenet_v2/MobileNetV2)
```python
class MobileNet_model(Model):
    def __init__(self, classes):
        super(MobileNet_model, self).__init__(name='MobileNet_Model')
        self.mobilenet = MobileNetV2(weights='imagenet'
                                    , include_top=False)
        for layer in self.mobilenet.layers:
            layer.trainable = False
        self.flat = Flatten()
        self.dense1 = Dense(128, activation='relu')
        self.dense2 = Dense(64, activation='relu')
        self.dense3 = Dense(classes, activation='softmax')

    def call(self, inputs):
        x = self.mobilenet(inputs)
        x = self.flat(x)
        x = self.dense1(x)
        x = self.dense2(x)
        outputs = self.dense3(x)
        return outputs

CONFIG['model'] = MobileNet_model(len(CONFIG['label_names']))
CONFIG['model'].build(CONFIG['shape'])
print(CONFIG['model'].summary())
```

```cmd
Model: "MobileNet_Model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 mobilenetv2_1.00_224 (Funct  (None, None, None, 1280)  2257984  
 ional)                                                          
                                                                 
 flatten_9 (Flatten)         multiple                  0         
                                                                 
 dense_21 (Dense)            multiple                  163968    
                                                                 
 dense_22 (Dense)            multiple                  8256      
                                                                 
 dense_23 (Dense)            multiple                  650       
                                                                 
=================================================================
Total params: 2,430,858
Trainable params: 172,874
Non-trainable params: 2,257,984
_________________________________________________________________
```

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 1.8455 - accuracy: 0.3470
```

![image](../../assets/images/post/cv_1/history_mbilenet.png){: .align-center width="80%"}

<br>

#### [ì „ì´í•™ìŠµ : ResNet50V2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/resnet_v2/ResNet50V2)
```python
class ResNet_model(Model):
    def __init__(self, classes):
        super(ResNet_model, self).__init__(name='ResNet_Model')
        self.resnet = ResNet50V2(weights='imagenet'
                                    , include_top=False
                                    , input_shape=(32, 32, 3))
        for layer in self.resnet.layers:
            layer.trainable = False
        self.flat = Flatten()
        self.dense1 = Dense(128, activation='relu')
        self.dense2 = Dense(64, activation='relu')
        self.dense3 = Dense(classes, activation='softmax')

    def call(self, inputs):
        x = self.resnet(inputs)
        x = self.flat(x)
        x = self.dense1(x)
        x = self.dense2(x)
        outputs = self.dense3(x)
        return outputs

CONFIG['model'] = ResNet_model(len(CONFIG['label_names']))
CONFIG['model'].build(CONFIG['shape'])
print(CONFIG['model'].summary())
```

```cmd
Model: "ResNet_Model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 resnet50v2 (Functional)     (None, 1, 1, 2048)        23564800  
                                                                 
 flatten_10 (Flatten)        multiple                  0         
                                                                 
 dense_24 (Dense)            multiple                  262272    
                                                                 
 dense_25 (Dense)            multiple                  8256      
                                                                 
 dense_26 (Dense)            multiple                  650       
                                                                 
=================================================================
Total params: 23,835,978
Trainable params: 271,178
Non-trainable params: 23,564,800
_________________________________________________________________
```

```python
CONFIG['model'].compile(optimizer=CONFIG['optimizer'],
              loss=CONFIG['loss'],
              metrics=CONFIG['metrics'])

CONFIG['history'] = CONFIG['model'].fit(X_train, y_train,
          batch_size=CONFIG['batch_size'],
          validation_data=(X_val, y_val),
          epochs=CONFIG['epochs'])

CONFIG['model'].evaluate(X_test, y_test)
# loss: 2.8342 - accuracy: 0.3629
```

![image](../../assets/images/post/cv_1/history_resnet.png){: .align-center width="80%"}

<br>

#### 3ê°€ì§€ ì „ì´í•™ìŠµ ëª¨ë¸, [VGG16](https://www.tensorflow.org/api_docs/python/tf/keras/applications/vgg16/VGG16), [MobileNetV2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/mobilenet_v2/MobileNetV2), [ResNet50V2](https://www.tensorflow.org/api_docs/python/tf/keras/applications/resnet_v2/ResNet50V2)ë“¤ì˜ ë¹„êµ ê²°ê³¼
- VGG16ì€ ì¢‹ì€ ì„±ëŠ¥ì´ ë‚˜ì™”ì§€ë§Œ MobileNetV2, ResNet50V2ì€ ì„±ëŠ¥ì´ ë–¨ì–´ì¡ŒìŒ
  - ê³¼ì œì— ë”°ë¼ì„œ ì ì ˆí•œ ì „ì´í•™ìŠµ ëª¨ë¸ì´ ìˆìŒ
- ë‹¨ì§€ ì „ì´í•™ìŠµ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë†’ì€ ì„±ëŠ¥ì„ ë³´ì¥í•˜ëŠ” ê²ƒì´ ì•„ë‹˜
  - ì „ì´í•™ìŠµ ëª¨ë¸ì— ë”°ë¥¸ ì ì ˆí•œ íŠœë‹ì´ ìˆì–´ì•¼ ë†’ì€ ì„±ëŠ¥ì„ ê¸°ëŒ€ í•  ìˆ˜ ìˆìŒ









<br><br><br><br>
<center>
<h1>ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ğŸ˜‰</h1>
</center>
<br><br><br><br>





