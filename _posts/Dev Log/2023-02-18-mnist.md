---
title: "MNIST ì¸ê³µì‹ ê²½ë§"
excerpt: "MNISTë¡œ ì¸ê³µì‹ ê²½ë§ êµ¬ì„±í•˜ê¸°"

categories:
  - Dev Log

tags:
  - ê°œë°œì¼ì§€
  - ì½”ë”©
  - keras
  - Neural Network

use_math: true

header:
  teaser: /assets/images/etc/woman-936722_1920.jpg

last_modified_at: 2023-02-18
---

<br><br>

![image-right]({{ site.url }}{{ site.baseurl }}/assets/images/etc/woman-936722_1920.jpg){: .align-center width="70%"}  

<br><br>

<br><br>

# Keras MNIST, ì¸ê³µì‹ ê²½ë§ êµ¬ì„±  

<br><br>

## ë„ì…  
>- mnist ë°ì´í„°ë¡œ ì¸ê³µì‹ ê²½ë§ ë§Œë“¤ê¸°  
>- ê°„ë‹¨í•œ ì¸ê³µì‹ ê²½ë§ì„ êµ¬ì„±í•˜ë©° ë”¥ëŸ¬ë‹ê³¼ ì¹œí•´ì§€ì  

<br><br>


## ë°ì´í„° ì¤€ë¹„  

### ë°ì´í„° ì½ì–´ì˜¤ê¸°  

```python
# ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤
(x_train, y_train), (x_test, y_test) = keras.datasets.mnist.load_data()
print(f"{x_train.shape}, {y_train.shape}, {x_test.shape}, {y_test.shape}")
```

```
(60000, 28, 28), (60000,), (10000, 28, 28), (10000,)
```

- mnist ë°ì´í„°ëŠ” keras ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•˜ì—¬ ì†ì‰½ê²Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.
- load_data() ë©”ì¨ë“œëŠ” ë„˜íŒŒì´ íŠœí”Œì„ ë°˜í™˜í•œë‹¤.
- í•™ìŠµë°ì´í„°ëŠ” 60,000ê°œ, í‰ê°€ë°ì´í„°ëŠ” 10,000ê°œì´ë‹¤.
- 28í”½ì…€ì˜ í‘/ë°± íŠ¹ì„±ì„ ë‹´ê³  ìˆë‹¤.


### ë°ì´í„° ì‚´í´ë³´ê¸°  

```python
attention_idx = 2000
x_train[attention_idx][10]
```

```
array([  0,   0,   0,   0,   0,   0,   0,   0,   0,  92, 255, 254, 254,
       119,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
         0,   0], dtype=uint8)
```

- í›ˆë ¨ë°ì´í„° 2,000ë²ˆ ì¸ë±ìŠ¤ì˜ íŠ¹ì„±ì„ ì‚´í´ë³´ë©´ 0~255ê¹Œì§€ì˜ ì •ìˆ˜ë¡œ ì´ë£¨ì–´ì ¸ìˆë‹¤.


- íŠ¹ì„± ë°ì´í„°ë¥¼ ì‹œê°í™” í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìˆ«ì ì†ê¸€ì”¨ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
label_list = list(np.unique(y_test))

fig, ax = plt.subplots(figsize=(10,10))

for i, val in enumerate(range(attention_idx-10,attention_idx+10)):
    plt.subplot(5,5,i+1)
    plt.xticks([])
    plt.yticks([])
    plt.grid(False)
    plt.imshow(x_train[val], cmap=plt.cm.binary)
    plt.xlabel(label_list[y_train[val]])
plt.show()
```

![image-right]({{ site.url }}{{ site.baseurl }}/assets/images/coding/mnist/mnist_review.png){: .align-center width="90%"}




### ë°ì´í„° ì „ì²˜ë¦¬  

```python
x_train, x_test = x_train / 255, x_test / 255 # Normalization
x_train[attention_idx][10] # 2,000ë²ˆ ì¸ë±ìŠ¤ ì‚´í´ë³´ê¸°
```

- ë°ì´í„°ë¥¼ 255ë¡œ ë‚˜ëˆ„ì–´ 0~1ì‚¬ì´ì˜ ìˆ˜ë¡œ ì •ê·œí™”(Normalization)í•œë‹¤.
- ì •ê·œí™” í•˜ëŠ” ì´ìœ ?
  - 0~1 ì‚¬ì´ë¡œ ë§ì¶”ì–´ ê³„ì‚° ê°’ì´ ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€
  - Local Minimunì— ë¹ ì§€ëŠ” ê²ƒì„ ë°©ì§€(í•™ìŠµ ì†ë„ í–¥ìƒ)




<br>
<br>
<br>
<br>



## ëª¨ë¸ë§

### ì¸ê³µì‹ ê²½ë§ êµ¬ì„±


```python
model = tf.keras.models.Sequential([
  Flatten(input_shape=(28, 28)),
  Dense(128, activation='relu'),
  Dropout(0.2),
  Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss='sparse_categorical_crossentropy',
              metrics=['accuracy'])
```

- 28í”½ì…€ì´ í‘ë°± ì´ê¸° ë•Œë¬¸ì— ì…ë ¥íŠ¹ì„±ì—ëŠ” (28, 28)ë¡œ ì…ë ¥í•œë‹¤.
- ì€ë‹‰ì¸µì˜ ë…¸ë“œëŠ” 128, í™œì„±í™” í•¨ìˆ˜ëŠ” reluë¡œ ì„¤ì •
- ê³¼ì í•©ì„ ë§‰ê¸°ìœ„í•˜ì—¬ Dropout 0.2 ì„¤ì •
- ì¶œë ¥ì€ 0~9ê¹Œì§€ì˜ ìˆ«ìì´ê¸° ë•Œë¬¸ì— 10, ë‹¤ì¤‘ë¶„ë¥˜ í•¨ìˆ˜ì¸ softmaxë¡œ ì„¤ì •


### ì‹ ê²½ë§ í•™ìŠµ

```python
model.fit(x_train, y_train, epochs=5)

model.evaluate(x_test,  y_test, verbose=2)
```

```
313/313 - 0s - loss: 0.0724 - accuracy: 0.9775 - 488ms/epoch - 2ms/step
[0.0723787322640419, 0.9775000214576721]
```

- 5ë²ˆ ìˆœì „íŒŒì™€ ì—­ì „íŒŒë¥¼ ë°˜ë³µí•˜ë©° ì‹ ê²½ë§ì„ í•™ìŠµ
- í‰ê°€ ë°ì´í„°ì— ëŒ€í•˜ì—¬ Accuracyë¥¼ ë°˜í™˜
- ì •í™•ë„ ì•½ 97.8%
- í˜¼ëˆí–‰ë ¬(Confusion Matrix)ì„ í™•ì¸í•´ë³´ë©´ ëŒ€ë¶€ë¶„ ë§ì¶˜ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

![image-right]({{ site.url }}{{ site.baseurl }}/assets/images/coding/mnist/mnist_cm.png){: .align-center width="90%"}



### ëª¨ë¸ í™•ì¸

```python
probability_model = tf.keras.Sequential([
  model,
  tf.keras.layers.Softmax()
])

pred_list = probability_model(x_train[attention_idx:attention_idx+1])
predictions_train = probability_model.predict(x_train)
predictions_test = probability_model.predict(x_test)
pred_list
```

```
1875/1875 [==============================] - 2s 1ms/step
313/313 [==============================] - 0s 1ms/step
<tf.Tensor: shape=(1, 10), dtype=float32, numpy=
array([[0.09005527, 0.08849514, 0.08866849, 0.08850201, 0.08851673,
        0.1622487 , 0.12685911, 0.08853356, 0.08893044, 0.08919058]],
      dtype=float32)>
```

- í›ˆë ¨ë°ì´í„° 2,000ë²ˆ ì¸ë±ìŠ¤ì˜ ëª¨ë¸ì¶”ì • ê²°ê³¼ 0,1,2,3,4ì¼ í™•ë¥ ì€ ì•½9%, <mark>5ì¼ í™•ë¥ ì€ ì•½16%, 6ì¼ í™•ë¥ ì€ ì•½12.7%</mark>, 7,8,9ì¼ í™•ë¥ ì€ ì•½9%

```python
np.argmax(predictions_train[attention_idx])
# 5
```

- ê²°êµ­ ëª¨ë¸ì˜ ì„ íƒì€ <mark>5</mark>!!

- í›ˆë ¨ë°ì´í„° 2,000ë²ˆ ì¸ë±ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´

```python
plt.figure()
plt.imshow(x_train[attention_idx], cmap='gray_r')
plt.colorbar()
plt.grid(False)
plt.show()
```

![image-right]({{ site.url }}{{ site.baseurl }}/assets/images/coding/mnist/mnist_2000.png){: .align-center width="60%"}

- 2,000ë²ˆì˜ ë¼ë²¨ì„ í™•ì¸í•´ë³´ë©´ 5ê°€ ë§ìŒ

```python
y_train[attention_idx]
# 5
```






<br>
<br>
<br>
<br>


<center>
<h1>ëê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ğŸ˜‰</h1>
</center>


<br>
<br>
<br>
<br>


<!-- 


{: .notice}
{: .notice--primary}
{: .notice--info}
{: .notice--warning}
{: .notice--danger}
{: .notice--success}

 -->





